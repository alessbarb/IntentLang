{"source_il":"types {\n  type Fixed2 = Int brand \"Fixed2\";\n}\n\nfunc mul(a: Fixed2, b: Fixed2): Fixed2\n{\n  return fixed2Mul(a, b);\n}\n","transpiled_ts":"export type Fixed2 = number & Brand<\"Fixed2\">;\nexport function mul(a: Fixed2, b: Fixed2): Fixed2 {\n  return fixed2Mul(a, b);\n}\n","ast":{"kind":"Program","types":{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Fixed2","span":{"start":{"line":2,"column":15,"index":22},"end":{"line":2,"column":15,"index":22}}},"expr":{"kind":"BrandType","base":{"kind":"BasicType","name":"Int","span":{"start":{"line":2,"column":26,"index":33},"end":{"line":2,"column":26,"index":33}}},"brand":"Fixed2","span":{"start":{"line":2,"column":26,"index":33},"end":{"line":2,"column":26,"index":33}}},"span":{"start":{"line":2,"column":7,"index":14},"end":{"line":2,"column":7,"index":14}}}],"span":{"start":{"line":1,"column":6,"index":5},"end":{"line":1,"column":6,"index":5}}},"items":[{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Fixed2","span":{"start":{"line":2,"column":15,"index":22},"end":{"line":2,"column":15,"index":22}}},"expr":{"kind":"BrandType","base":{"kind":"BasicType","name":"Int","span":{"start":{"line":2,"column":26,"index":33},"end":{"line":2,"column":26,"index":33}}},"brand":"Fixed2","span":{"start":{"line":2,"column":26,"index":33},"end":{"line":2,"column":26,"index":33}}},"span":{"start":{"line":2,"column":7,"index":14},"end":{"line":2,"column":7,"index":14}}}],"span":{"start":{"line":1,"column":6,"index":5},"end":{"line":1,"column":6,"index":5}}},{"kind":"FuncDecl","name":{"kind":"Identifier","name":"mul","span":{"start":{"line":5,"column":9,"index":55},"end":{"line":5,"column":9,"index":55}}},"params":[{"kind":"ParamSig","name":{"kind":"Identifier","name":"a","span":{"start":{"line":5,"column":11,"index":57},"end":{"line":5,"column":11,"index":57}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"Fixed2","span":{"start":{"line":5,"column":19,"index":65},"end":{"line":5,"column":19,"index":65}}},"span":{"start":{"line":5,"column":19,"index":65},"end":{"line":5,"column":19,"index":65}}},"span":{"start":{"line":5,"column":11,"index":57},"end":{"line":5,"column":11,"index":57}}},{"kind":"ParamSig","name":{"kind":"Identifier","name":"b","span":{"start":{"line":5,"column":22,"index":68},"end":{"line":5,"column":22,"index":68}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"Fixed2","span":{"start":{"line":5,"column":30,"index":76},"end":{"line":5,"column":30,"index":76}}},"span":{"start":{"line":5,"column":30,"index":76},"end":{"line":5,"column":30,"index":76}}},"span":{"start":{"line":5,"column":22,"index":68},"end":{"line":5,"column":22,"index":68}}}],"returnType":{"kind":"NamedType","name":{"kind":"Identifier","name":"Fixed2","span":{"start":{"line":6,"column":1,"index":86},"end":{"line":6,"column":1,"index":86}}},"span":{"start":{"line":6,"column":1,"index":86},"end":{"line":6,"column":1,"index":86}}},"body":{"kind":"Block","statements":[{"kind":"ReturnStmt","argument":{"kind":"CallExpr","callee":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"fixed2Mul","span":{"start":{"line":7,"column":19,"index":106},"end":{"line":7,"column":19,"index":106}}},"span":{"start":{"line":7,"column":19,"index":106},"end":{"line":7,"column":19,"index":106}}},"args":[{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"a","span":{"start":{"line":7,"column":21,"index":108},"end":{"line":7,"column":21,"index":108}}},"span":{"start":{"line":7,"column":21,"index":108},"end":{"line":7,"column":21,"index":108}}},{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"b","span":{"start":{"line":7,"column":24,"index":111},"end":{"line":7,"column":24,"index":111}}},"span":{"start":{"line":7,"column":24,"index":111},"end":{"line":7,"column":24,"index":111}}}],"span":{"start":{"line":7,"column":25,"index":112},"end":{"line":7,"column":25,"index":112}}},"span":{"start":{"line":7,"column":9,"index":96},"end":{"line":7,"column":9,"index":96}}}],"span":{"start":{"line":6,"column":1,"index":86},"end":{"line":6,"column":1,"index":86}}},"span":{"start":{"line":5,"column":5,"index":51},"end":{"line":5,"column":5,"index":51}}}],"span":{"start":{"line":1,"column":1,"index":0},"end":{"line":9,"column":1,"index":116}}}}
{"source_il":"intent \"Invoice service\" tags [\"billing\",\"invoice\"]\r\n\r\nuses {\r\n  http: Http { baseUrl: \"https://api.example.com\", timeoutMs: 3000 },\r\n  clock: Clock {},\r\n}\r\n\r\ntypes {\r\n  type InvoiceId = Uuid;\r\n  type Invoice = {\r\n    id: InvoiceId,\r\n    orderId: Uuid,\r\n    issuedAt: DateTime,\r\n  };\r\n  type InvoiceError = { code: Int, message: String };\r\n}\r\n\r\neffect generateInvoice(orderId: Uuid): Result<Invoice, InvoiceError> uses http, clock {\n  return http.post(\"/invoices\", { orderId, issuedAt: clock.now() });\n}\n","transpiled_ts":"export type InvoiceId = string;\nexport interface Invoice {\n  id: InvoiceId;\n  orderId: string;\n  issuedAt: Date;\n}\nexport interface InvoiceError {\n  code: number;\n  message: string;\n}\n\nexport async function generateInvoice(\n  deps: { http: Http; clock: Clock },\n  orderId: string,\n): Promise<Result<Invoice, InvoiceError>> {\n  return deps.http.post<Invoice>(\"/invoices\", {\n    orderId,\n    issuedAt: deps.clock.now(),\n  });\n}\n","ast":{"kind":"Program","intent":{"kind":"IntentSection","description":"Invoice service","tags":["billing","invoice"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},"uses":{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":69},"end":{"line":4,"column":7,"index":69}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":76},"end":{"line":4,"column":14,"index":76}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":112},"end":{"line":4,"column":50,"index":112}}},"timeoutMs":{"kind":"Number","value":3000,"span":{"start":{"line":4,"column":67,"index":129},"end":{"line":4,"column":67,"index":129}}}},"span":{"start":{"line":3,"column":5,"index":59},"end":{"line":3,"column":5,"index":59}}},{"kind":"UseDecl","name":{"kind":"Identifier","name":"clock","span":{"start":{"line":5,"column":8,"index":141},"end":{"line":5,"column":8,"index":141}}},"typeName":{"kind":"Identifier","name":"Clock","span":{"start":{"line":5,"column":16,"index":149},"end":{"line":5,"column":16,"index":149}}},"params":{},"span":{"start":{"line":3,"column":5,"index":59},"end":{"line":3,"column":5,"index":59}}}],"span":{"start":{"line":3,"column":5,"index":59},"end":{"line":3,"column":5,"index":59}}},"types":{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"InvoiceId","span":{"start":{"line":9,"column":18,"index":185},"end":{"line":9,"column":18,"index":185}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":9,"column":24,"index":191},"end":{"line":9,"column":24,"index":191}}},"span":{"start":{"line":9,"column":7,"index":174},"end":{"line":9,"column":7,"index":174}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Invoice","span":{"start":{"line":10,"column":16,"index":209},"end":{"line":10,"column":16,"index":209}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":11,"column":7,"index":220},"end":{"line":11,"column":7,"index":220}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"InvoiceId","span":{"start":{"line":11,"column":18,"index":231},"end":{"line":11,"column":18,"index":231}}},"span":{"start":{"line":11,"column":18,"index":231},"end":{"line":11,"column":18,"index":231}}},"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"orderId","span":{"start":{"line":12,"column":12,"index":245},"end":{"line":12,"column":12,"index":245}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":12,"column":18,"index":251},"end":{"line":12,"column":18,"index":251}}},"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"issuedAt","span":{"start":{"line":13,"column":13,"index":266},"end":{"line":13,"column":13,"index":266}}},"type":{"kind":"BasicType","name":"DateTime","span":{"start":{"line":13,"column":23,"index":276},"end":{"line":13,"column":23,"index":276}}},"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}}],"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}},"span":{"start":{"line":10,"column":7,"index":200},"end":{"line":10,"column":7,"index":200}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"InvoiceError","span":{"start":{"line":15,"column":21,"index":305},"end":{"line":15,"column":21,"index":305}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":15,"column":29,"index":313},"end":{"line":15,"column":29,"index":313}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":15,"column":34,"index":318},"end":{"line":15,"column":34,"index":318}}},"span":{"start":{"line":15,"column":23,"index":307},"end":{"line":15,"column":23,"index":307}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":15,"column":43,"index":327},"end":{"line":15,"column":43,"index":327}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":15,"column":52,"index":336},"end":{"line":15,"column":52,"index":336}}},"span":{"start":{"line":15,"column":23,"index":307},"end":{"line":15,"column":23,"index":307}}}],"span":{"start":{"line":15,"column":23,"index":307},"end":{"line":15,"column":23,"index":307}}},"span":{"start":{"line":15,"column":7,"index":291},"end":{"line":15,"column":7,"index":291}}}],"span":{"start":{"line":8,"column":6,"index":164},"end":{"line":8,"column":6,"index":164}}},"items":[{"kind":"IntentSection","description":"Invoice service","tags":["billing","invoice"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":69},"end":{"line":4,"column":7,"index":69}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":76},"end":{"line":4,"column":14,"index":76}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":112},"end":{"line":4,"column":50,"index":112}}},"timeoutMs":{"kind":"Number","value":3000,"span":{"start":{"line":4,"column":67,"index":129},"end":{"line":4,"column":67,"index":129}}}},"span":{"start":{"line":3,"column":5,"index":59},"end":{"line":3,"column":5,"index":59}}},{"kind":"UseDecl","name":{"kind":"Identifier","name":"clock","span":{"start":{"line":5,"column":8,"index":141},"end":{"line":5,"column":8,"index":141}}},"typeName":{"kind":"Identifier","name":"Clock","span":{"start":{"line":5,"column":16,"index":149},"end":{"line":5,"column":16,"index":149}}},"params":{},"span":{"start":{"line":3,"column":5,"index":59},"end":{"line":3,"column":5,"index":59}}}],"span":{"start":{"line":3,"column":5,"index":59},"end":{"line":3,"column":5,"index":59}}},{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"InvoiceId","span":{"start":{"line":9,"column":18,"index":185},"end":{"line":9,"column":18,"index":185}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":9,"column":24,"index":191},"end":{"line":9,"column":24,"index":191}}},"span":{"start":{"line":9,"column":7,"index":174},"end":{"line":9,"column":7,"index":174}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Invoice","span":{"start":{"line":10,"column":16,"index":209},"end":{"line":10,"column":16,"index":209}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":11,"column":7,"index":220},"end":{"line":11,"column":7,"index":220}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"InvoiceId","span":{"start":{"line":11,"column":18,"index":231},"end":{"line":11,"column":18,"index":231}}},"span":{"start":{"line":11,"column":18,"index":231},"end":{"line":11,"column":18,"index":231}}},"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"orderId","span":{"start":{"line":12,"column":12,"index":245},"end":{"line":12,"column":12,"index":245}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":12,"column":18,"index":251},"end":{"line":12,"column":18,"index":251}}},"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"issuedAt","span":{"start":{"line":13,"column":13,"index":266},"end":{"line":13,"column":13,"index":266}}},"type":{"kind":"BasicType","name":"DateTime","span":{"start":{"line":13,"column":23,"index":276},"end":{"line":13,"column":23,"index":276}}},"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}}],"span":{"start":{"line":10,"column":18,"index":211},"end":{"line":10,"column":18,"index":211}}},"span":{"start":{"line":10,"column":7,"index":200},"end":{"line":10,"column":7,"index":200}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"InvoiceError","span":{"start":{"line":15,"column":21,"index":305},"end":{"line":15,"column":21,"index":305}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":15,"column":29,"index":313},"end":{"line":15,"column":29,"index":313}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":15,"column":34,"index":318},"end":{"line":15,"column":34,"index":318}}},"span":{"start":{"line":15,"column":23,"index":307},"end":{"line":15,"column":23,"index":307}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":15,"column":43,"index":327},"end":{"line":15,"column":43,"index":327}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":15,"column":52,"index":336},"end":{"line":15,"column":52,"index":336}}},"span":{"start":{"line":15,"column":23,"index":307},"end":{"line":15,"column":23,"index":307}}}],"span":{"start":{"line":15,"column":23,"index":307},"end":{"line":15,"column":23,"index":307}}},"span":{"start":{"line":15,"column":7,"index":291},"end":{"line":15,"column":7,"index":291}}}],"span":{"start":{"line":8,"column":6,"index":164},"end":{"line":8,"column":6,"index":164}}},{"kind":"EffectDecl","name":{"kind":"Identifier","name":"generateInvoice","span":{"start":{"line":18,"column":23,"index":367},"end":{"line":18,"column":23,"index":367}}},"params":[{"kind":"ParamSig","name":{"kind":"Identifier","name":"orderId","span":{"start":{"line":18,"column":31,"index":375},"end":{"line":18,"column":31,"index":375}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":18,"column":37,"index":381},"end":{"line":18,"column":37,"index":381}}},"span":{"start":{"line":18,"column":31,"index":375},"end":{"line":18,"column":31,"index":375}}}],"returnType":{"kind":"GenericType","name":{"kind":"Identifier","name":"Result","span":{"start":{"line":18,"column":46,"index":390},"end":{"line":18,"column":46,"index":390}}},"params":[{"kind":"NamedType","name":{"kind":"Identifier","name":"Invoice","span":{"start":{"line":18,"column":54,"index":398},"end":{"line":18,"column":54,"index":398}}},"span":{"start":{"line":18,"column":54,"index":398},"end":{"line":18,"column":54,"index":398}}},{"kind":"NamedType","name":{"kind":"Identifier","name":"InvoiceError","span":{"start":{"line":18,"column":68,"index":412},"end":{"line":18,"column":68,"index":412}}},"span":{"start":{"line":18,"column":68,"index":412},"end":{"line":18,"column":68,"index":412}}}],"span":{"start":{"line":18,"column":46,"index":390},"end":{"line":18,"column":46,"index":390}}},"uses":[{"kind":"Identifier","name":"http","span":{"start":{"line":18,"column":79,"index":423},"end":{"line":18,"column":79,"index":423}}},{"kind":"Identifier","name":"clock","span":{"start":{"line":18,"column":87,"index":431},"end":{"line":18,"column":87,"index":431}}}],"body":{"kind":"Block","statements":[{"kind":"ReturnStmt","argument":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"http","span":{"start":{"line":19,"column":14,"index":446},"end":{"line":19,"column":14,"index":446}}},"span":{"start":{"line":19,"column":14,"index":446},"end":{"line":19,"column":14,"index":446}}},"property":{"kind":"Identifier","name":"post","span":{"start":{"line":19,"column":19,"index":451},"end":{"line":19,"column":19,"index":451}}},"span":{"start":{"line":19,"column":19,"index":451},"end":{"line":19,"column":19,"index":451}}},"args":[{"kind":"LiteralExpr","value":{"kind":"String","value":"/invoices","span":{"start":{"line":19,"column":31,"index":463},"end":{"line":19,"column":31,"index":463}}},"span":{"start":{"line":19,"column":31,"index":463},"end":{"line":19,"column":31,"index":463}}},{"kind":"ObjectExpr","fields":[{"kind":"ObjectField","key":{"kind":"Identifier","name":"orderId","span":{"start":{"line":19,"column":42,"index":474},"end":{"line":19,"column":42,"index":474}}},"value":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"orderId","span":{"start":{"line":19,"column":42,"index":474},"end":{"line":19,"column":42,"index":474}}},"span":{"start":{"line":19,"column":42,"index":474},"end":{"line":19,"column":42,"index":474}}},"span":{"start":{"line":19,"column":33,"index":465},"end":{"line":19,"column":33,"index":465}}},{"kind":"ObjectField","key":{"kind":"Identifier","name":"issuedAt","span":{"start":{"line":19,"column":52,"index":484},"end":{"line":19,"column":52,"index":484}}},"value":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"clock","span":{"start":{"line":19,"column":59,"index":491},"end":{"line":19,"column":59,"index":491}}},"span":{"start":{"line":19,"column":59,"index":491},"end":{"line":19,"column":59,"index":491}}},"property":{"kind":"Identifier","name":"now","span":{"start":{"line":19,"column":63,"index":495},"end":{"line":19,"column":63,"index":495}}},"span":{"start":{"line":19,"column":63,"index":495},"end":{"line":19,"column":63,"index":495}}},"args":[],"span":{"start":{"line":19,"column":66,"index":498},"end":{"line":19,"column":66,"index":498}}},"span":{"start":{"line":19,"column":33,"index":465},"end":{"line":19,"column":33,"index":465}}}],"span":{"start":{"line":19,"column":33,"index":465},"end":{"line":19,"column":33,"index":465}}}],"span":{"start":{"line":19,"column":68,"index":500},"end":{"line":19,"column":68,"index":500}}},"span":{"start":{"line":19,"column":9,"index":441},"end":{"line":19,"column":9,"index":441}}}],"span":{"start":{"line":18,"column":87,"index":431},"end":{"line":18,"column":87,"index":431}}},"span":{"start":{"line":18,"column":7,"index":351},"end":{"line":18,"column":7,"index":351}}}],"span":{"start":{"line":1,"column":1,"index":0},"end":{"line":21,"column":1,"index":504}}}}
{"source_il":"intent \"Notification service\" tags [\"notifications\"]\r\n\r\nuses {\r\n  http: Http { baseUrl: \"https://api.example.com\", timeoutMs: 3000 },\r\n}\r\n\r\ntypes {\r\n  type NotificationId = Uuid;\r\n  type Notification = {\r\n    id: NotificationId,\r\n    userId: Uuid,\r\n    message: String,\r\n  };\r\n  type NotificationError = { code: Int, message: String };\r\n}\r\n\r\neffect sendNotification(input: { userId: Uuid, message: String }): Result<Notification, NotificationError> uses http {\n  return http.post(\"/notifications\", input);\n}\n","transpiled_ts":"export type NotificationId = string;\nexport interface Notification {\n  id: NotificationId;\n  userId: string;\n  message: string;\n}\nexport interface NotificationError {\n  code: number;\n  message: string;\n}\n\nexport async function sendNotification(\n  deps: { http: Http },\n  input: { userId: string; message: string },\n): Promise<Result<Notification, NotificationError>> {\n  return deps.http.post<Notification>(\"/notifications\", input);\n}\n","ast":{"kind":"Program","intent":{"kind":"IntentSection","description":"Notification service","tags":["notifications"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},"uses":{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":70},"end":{"line":4,"column":7,"index":70}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":77},"end":{"line":4,"column":14,"index":77}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":113},"end":{"line":4,"column":50,"index":113}}},"timeoutMs":{"kind":"Number","value":3000,"span":{"start":{"line":4,"column":67,"index":130},"end":{"line":4,"column":67,"index":130}}}},"span":{"start":{"line":3,"column":5,"index":60},"end":{"line":3,"column":5,"index":60}}}],"span":{"start":{"line":3,"column":5,"index":60},"end":{"line":3,"column":5,"index":60}}},"types":{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"NotificationId","span":{"start":{"line":8,"column":23,"index":171},"end":{"line":8,"column":23,"index":171}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":8,"column":29,"index":177},"end":{"line":8,"column":29,"index":177}}},"span":{"start":{"line":8,"column":7,"index":155},"end":{"line":8,"column":7,"index":155}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Notification","span":{"start":{"line":9,"column":21,"index":200},"end":{"line":9,"column":21,"index":200}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":10,"column":7,"index":211},"end":{"line":10,"column":7,"index":211}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"NotificationId","span":{"start":{"line":10,"column":23,"index":227},"end":{"line":10,"column":23,"index":227}}},"span":{"start":{"line":10,"column":23,"index":227},"end":{"line":10,"column":23,"index":227}}},"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"userId","span":{"start":{"line":11,"column":11,"index":240},"end":{"line":11,"column":11,"index":240}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":11,"column":17,"index":246},"end":{"line":11,"column":17,"index":246}}},"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":12,"column":12,"index":260},"end":{"line":12,"column":12,"index":260}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":12,"column":20,"index":268},"end":{"line":12,"column":20,"index":268}}},"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}}],"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}},"span":{"start":{"line":9,"column":7,"index":186},"end":{"line":9,"column":7,"index":186}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"NotificationError","span":{"start":{"line":14,"column":26,"index":302},"end":{"line":14,"column":26,"index":302}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":14,"column":34,"index":310},"end":{"line":14,"column":34,"index":310}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":14,"column":39,"index":315},"end":{"line":14,"column":39,"index":315}}},"span":{"start":{"line":14,"column":28,"index":304},"end":{"line":14,"column":28,"index":304}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":14,"column":48,"index":324},"end":{"line":14,"column":48,"index":324}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":14,"column":57,"index":333},"end":{"line":14,"column":57,"index":333}}},"span":{"start":{"line":14,"column":28,"index":304},"end":{"line":14,"column":28,"index":304}}}],"span":{"start":{"line":14,"column":28,"index":304},"end":{"line":14,"column":28,"index":304}}},"span":{"start":{"line":14,"column":7,"index":283},"end":{"line":14,"column":7,"index":283}}}],"span":{"start":{"line":7,"column":6,"index":145},"end":{"line":7,"column":6,"index":145}}},"items":[{"kind":"IntentSection","description":"Notification service","tags":["notifications"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":70},"end":{"line":4,"column":7,"index":70}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":77},"end":{"line":4,"column":14,"index":77}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":113},"end":{"line":4,"column":50,"index":113}}},"timeoutMs":{"kind":"Number","value":3000,"span":{"start":{"line":4,"column":67,"index":130},"end":{"line":4,"column":67,"index":130}}}},"span":{"start":{"line":3,"column":5,"index":60},"end":{"line":3,"column":5,"index":60}}}],"span":{"start":{"line":3,"column":5,"index":60},"end":{"line":3,"column":5,"index":60}}},{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"NotificationId","span":{"start":{"line":8,"column":23,"index":171},"end":{"line":8,"column":23,"index":171}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":8,"column":29,"index":177},"end":{"line":8,"column":29,"index":177}}},"span":{"start":{"line":8,"column":7,"index":155},"end":{"line":8,"column":7,"index":155}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Notification","span":{"start":{"line":9,"column":21,"index":200},"end":{"line":9,"column":21,"index":200}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":10,"column":7,"index":211},"end":{"line":10,"column":7,"index":211}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"NotificationId","span":{"start":{"line":10,"column":23,"index":227},"end":{"line":10,"column":23,"index":227}}},"span":{"start":{"line":10,"column":23,"index":227},"end":{"line":10,"column":23,"index":227}}},"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"userId","span":{"start":{"line":11,"column":11,"index":240},"end":{"line":11,"column":11,"index":240}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":11,"column":17,"index":246},"end":{"line":11,"column":17,"index":246}}},"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":12,"column":12,"index":260},"end":{"line":12,"column":12,"index":260}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":12,"column":20,"index":268},"end":{"line":12,"column":20,"index":268}}},"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}}],"span":{"start":{"line":9,"column":23,"index":202},"end":{"line":9,"column":23,"index":202}}},"span":{"start":{"line":9,"column":7,"index":186},"end":{"line":9,"column":7,"index":186}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"NotificationError","span":{"start":{"line":14,"column":26,"index":302},"end":{"line":14,"column":26,"index":302}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":14,"column":34,"index":310},"end":{"line":14,"column":34,"index":310}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":14,"column":39,"index":315},"end":{"line":14,"column":39,"index":315}}},"span":{"start":{"line":14,"column":28,"index":304},"end":{"line":14,"column":28,"index":304}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":14,"column":48,"index":324},"end":{"line":14,"column":48,"index":324}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":14,"column":57,"index":333},"end":{"line":14,"column":57,"index":333}}},"span":{"start":{"line":14,"column":28,"index":304},"end":{"line":14,"column":28,"index":304}}}],"span":{"start":{"line":14,"column":28,"index":304},"end":{"line":14,"column":28,"index":304}}},"span":{"start":{"line":14,"column":7,"index":283},"end":{"line":14,"column":7,"index":283}}}],"span":{"start":{"line":7,"column":6,"index":145},"end":{"line":7,"column":6,"index":145}}},{"kind":"EffectDecl","name":{"kind":"Identifier","name":"sendNotification","span":{"start":{"line":17,"column":24,"index":365},"end":{"line":17,"column":24,"index":365}}},"params":[{"kind":"ParamSig","name":{"kind":"Identifier","name":"input","span":{"start":{"line":17,"column":30,"index":371},"end":{"line":17,"column":30,"index":371}}},"type":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"userId","span":{"start":{"line":17,"column":40,"index":381},"end":{"line":17,"column":40,"index":381}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":17,"column":46,"index":387},"end":{"line":17,"column":46,"index":387}}},"span":{"start":{"line":17,"column":32,"index":373},"end":{"line":17,"column":32,"index":373}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":17,"column":55,"index":396},"end":{"line":17,"column":55,"index":396}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":17,"column":64,"index":405},"end":{"line":17,"column":64,"index":405}}},"span":{"start":{"line":17,"column":32,"index":373},"end":{"line":17,"column":32,"index":373}}}],"span":{"start":{"line":17,"column":32,"index":373},"end":{"line":17,"column":32,"index":373}}},"span":{"start":{"line":17,"column":30,"index":371},"end":{"line":17,"column":30,"index":371}}}],"returnType":{"kind":"GenericType","name":{"kind":"Identifier","name":"Result","span":{"start":{"line":17,"column":74,"index":415},"end":{"line":17,"column":74,"index":415}}},"params":[{"kind":"NamedType","name":{"kind":"Identifier","name":"Notification","span":{"start":{"line":17,"column":87,"index":428},"end":{"line":17,"column":87,"index":428}}},"span":{"start":{"line":17,"column":87,"index":428},"end":{"line":17,"column":87,"index":428}}},{"kind":"NamedType","name":{"kind":"Identifier","name":"NotificationError","span":{"start":{"line":17,"column":106,"index":447},"end":{"line":17,"column":106,"index":447}}},"span":{"start":{"line":17,"column":106,"index":447},"end":{"line":17,"column":106,"index":447}}}],"span":{"start":{"line":17,"column":74,"index":415},"end":{"line":17,"column":74,"index":415}}},"uses":[{"kind":"Identifier","name":"http","span":{"start":{"line":17,"column":118,"index":459},"end":{"line":17,"column":118,"index":459}}}],"body":{"kind":"Block","statements":[{"kind":"ReturnStmt","argument":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"http","span":{"start":{"line":18,"column":14,"index":474},"end":{"line":18,"column":14,"index":474}}},"span":{"start":{"line":18,"column":14,"index":474},"end":{"line":18,"column":14,"index":474}}},"property":{"kind":"Identifier","name":"post","span":{"start":{"line":18,"column":19,"index":479},"end":{"line":18,"column":19,"index":479}}},"span":{"start":{"line":18,"column":19,"index":479},"end":{"line":18,"column":19,"index":479}}},"args":[{"kind":"LiteralExpr","value":{"kind":"String","value":"/notifications","span":{"start":{"line":18,"column":36,"index":496},"end":{"line":18,"column":36,"index":496}}},"span":{"start":{"line":18,"column":36,"index":496},"end":{"line":18,"column":36,"index":496}}},{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"input","span":{"start":{"line":18,"column":43,"index":503},"end":{"line":18,"column":43,"index":503}}},"span":{"start":{"line":18,"column":43,"index":503},"end":{"line":18,"column":43,"index":503}}}],"span":{"start":{"line":18,"column":44,"index":504},"end":{"line":18,"column":44,"index":504}}},"span":{"start":{"line":18,"column":9,"index":469},"end":{"line":18,"column":9,"index":469}}}],"span":{"start":{"line":17,"column":118,"index":459},"end":{"line":17,"column":118,"index":459}}},"span":{"start":{"line":17,"column":7,"index":348},"end":{"line":17,"column":7,"index":348}}}],"span":{"start":{"line":1,"column":1,"index":0},"end":{"line":20,"column":1,"index":508}}}}
{"source_il":"intent \"Order service\" tags [\"api\",\"orders\"]\r\n\r\nuses {\r\n  http: Http { baseUrl: \"https://api.example.com\", timeoutMs: 3000 },\r\n  random: Random { seed: 42 },\r\n}\r\n\r\ntypes {\r\n  type OrderId = Uuid;\r\n  type Order = {\r\n    id: OrderId,\r\n    userId: Uuid,\r\n    total: Float where _ >= 0,\r\n  };\r\n  type OrderError = { code: Int, message: String };\r\n}\r\n\r\neffect createOrder(input: { userId: Uuid, total: Float }): Result<Order, OrderError> uses http, random {\r\n  let id = random.next().toString();\r\n  return http.post(\"/orders\", { id: brand<OrderId>(id), userId: input.userId, total: input.total });\r\n}\r\n","transpiled_ts":"export type OrderId = string;\nexport interface Order {\n  id: OrderId;\n  userId: string;\n  total: number;\n}\nexport interface OrderError {\n  code: number;\n  message: string;\n}\n\nexport async function createOrder(\n  deps: { http: Http; random: Random },\n  input: { userId: string; total: number },\n): Promise<Result<Order, OrderError>> {\n  const id = deps.random.next().toString() as OrderId;\n  return deps.http.post<Order>(\"/orders\", {\n    id,\n    userId: input.userId,\n    total: input.total,\n  });\n}\n","ast":{"kind":"Program","intent":{"kind":"IntentSection","description":"Order service","tags":["api","orders"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},"uses":{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":62},"end":{"line":4,"column":7,"index":62}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":69},"end":{"line":4,"column":14,"index":69}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":105},"end":{"line":4,"column":50,"index":105}}},"timeoutMs":{"kind":"Number","value":3000,"span":{"start":{"line":4,"column":67,"index":122},"end":{"line":4,"column":67,"index":122}}}},"span":{"start":{"line":3,"column":5,"index":52},"end":{"line":3,"column":5,"index":52}}},{"kind":"UseDecl","name":{"kind":"Identifier","name":"random","span":{"start":{"line":5,"column":9,"index":135},"end":{"line":5,"column":9,"index":135}}},"typeName":{"kind":"Identifier","name":"Random","span":{"start":{"line":5,"column":18,"index":144},"end":{"line":5,"column":18,"index":144}}},"params":{"seed":{"kind":"Number","value":42,"span":{"start":{"line":5,"column":28,"index":154},"end":{"line":5,"column":28,"index":154}}}},"span":{"start":{"line":3,"column":5,"index":52},"end":{"line":3,"column":5,"index":52}}}],"span":{"start":{"line":3,"column":5,"index":52},"end":{"line":3,"column":5,"index":52}}},"types":{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"OrderId","span":{"start":{"line":9,"column":16,"index":188},"end":{"line":9,"column":16,"index":188}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":9,"column":22,"index":194},"end":{"line":9,"column":22,"index":194}}},"span":{"start":{"line":9,"column":7,"index":179},"end":{"line":9,"column":7,"index":179}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Order","span":{"start":{"line":10,"column":14,"index":210},"end":{"line":10,"column":14,"index":210}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":11,"column":7,"index":221},"end":{"line":11,"column":7,"index":221}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"OrderId","span":{"start":{"line":11,"column":16,"index":230},"end":{"line":11,"column":16,"index":230}}},"span":{"start":{"line":11,"column":16,"index":230},"end":{"line":11,"column":16,"index":230}}},"span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"userId","span":{"start":{"line":12,"column":11,"index":243},"end":{"line":12,"column":11,"index":243}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":12,"column":17,"index":249},"end":{"line":12,"column":17,"index":249}}},"span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"total","span":{"start":{"line":13,"column":10,"index":261},"end":{"line":13,"column":10,"index":261}}},"type":{"kind":"BasicType","name":"Float","span":{"start":{"line":13,"column":23,"index":274},"end":{"line":13,"column":23,"index":274}}},"refinement":"_ >= 0","span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}}],"span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}},"span":{"start":{"line":10,"column":7,"index":203},"end":{"line":10,"column":7,"index":203}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"OrderError","span":{"start":{"line":15,"column":19,"index":308},"end":{"line":15,"column":19,"index":308}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":15,"column":27,"index":316},"end":{"line":15,"column":27,"index":316}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":15,"column":32,"index":321},"end":{"line":15,"column":32,"index":321}}},"span":{"start":{"line":15,"column":21,"index":310},"end":{"line":15,"column":21,"index":310}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":15,"column":41,"index":330},"end":{"line":15,"column":41,"index":330}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":15,"column":50,"index":339},"end":{"line":15,"column":50,"index":339}}},"span":{"start":{"line":15,"column":21,"index":310},"end":{"line":15,"column":21,"index":310}}}],"span":{"start":{"line":15,"column":21,"index":310},"end":{"line":15,"column":21,"index":310}}},"span":{"start":{"line":15,"column":7,"index":296},"end":{"line":15,"column":7,"index":296}}}],"span":{"start":{"line":8,"column":6,"index":169},"end":{"line":8,"column":6,"index":169}}},"items":[{"kind":"IntentSection","description":"Order service","tags":["api","orders"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":62},"end":{"line":4,"column":7,"index":62}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":69},"end":{"line":4,"column":14,"index":69}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":105},"end":{"line":4,"column":50,"index":105}}},"timeoutMs":{"kind":"Number","value":3000,"span":{"start":{"line":4,"column":67,"index":122},"end":{"line":4,"column":67,"index":122}}}},"span":{"start":{"line":3,"column":5,"index":52},"end":{"line":3,"column":5,"index":52}}},{"kind":"UseDecl","name":{"kind":"Identifier","name":"random","span":{"start":{"line":5,"column":9,"index":135},"end":{"line":5,"column":9,"index":135}}},"typeName":{"kind":"Identifier","name":"Random","span":{"start":{"line":5,"column":18,"index":144},"end":{"line":5,"column":18,"index":144}}},"params":{"seed":{"kind":"Number","value":42,"span":{"start":{"line":5,"column":28,"index":154},"end":{"line":5,"column":28,"index":154}}}},"span":{"start":{"line":3,"column":5,"index":52},"end":{"line":3,"column":5,"index":52}}}],"span":{"start":{"line":3,"column":5,"index":52},"end":{"line":3,"column":5,"index":52}}},{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"OrderId","span":{"start":{"line":9,"column":16,"index":188},"end":{"line":9,"column":16,"index":188}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":9,"column":22,"index":194},"end":{"line":9,"column":22,"index":194}}},"span":{"start":{"line":9,"column":7,"index":179},"end":{"line":9,"column":7,"index":179}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Order","span":{"start":{"line":10,"column":14,"index":210},"end":{"line":10,"column":14,"index":210}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":11,"column":7,"index":221},"end":{"line":11,"column":7,"index":221}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"OrderId","span":{"start":{"line":11,"column":16,"index":230},"end":{"line":11,"column":16,"index":230}}},"span":{"start":{"line":11,"column":16,"index":230},"end":{"line":11,"column":16,"index":230}}},"span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"userId","span":{"start":{"line":12,"column":11,"index":243},"end":{"line":12,"column":11,"index":243}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":12,"column":17,"index":249},"end":{"line":12,"column":17,"index":249}}},"span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"total","span":{"start":{"line":13,"column":10,"index":261},"end":{"line":13,"column":10,"index":261}}},"type":{"kind":"BasicType","name":"Float","span":{"start":{"line":13,"column":23,"index":274},"end":{"line":13,"column":23,"index":274}}},"refinement":"_ >= 0","span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}}],"span":{"start":{"line":10,"column":16,"index":212},"end":{"line":10,"column":16,"index":212}}},"span":{"start":{"line":10,"column":7,"index":203},"end":{"line":10,"column":7,"index":203}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"OrderError","span":{"start":{"line":15,"column":19,"index":308},"end":{"line":15,"column":19,"index":308}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":15,"column":27,"index":316},"end":{"line":15,"column":27,"index":316}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":15,"column":32,"index":321},"end":{"line":15,"column":32,"index":321}}},"span":{"start":{"line":15,"column":21,"index":310},"end":{"line":15,"column":21,"index":310}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":15,"column":41,"index":330},"end":{"line":15,"column":41,"index":330}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":15,"column":50,"index":339},"end":{"line":15,"column":50,"index":339}}},"span":{"start":{"line":15,"column":21,"index":310},"end":{"line":15,"column":21,"index":310}}}],"span":{"start":{"line":15,"column":21,"index":310},"end":{"line":15,"column":21,"index":310}}},"span":{"start":{"line":15,"column":7,"index":296},"end":{"line":15,"column":7,"index":296}}}],"span":{"start":{"line":8,"column":6,"index":169},"end":{"line":8,"column":6,"index":169}}},{"kind":"EffectDecl","name":{"kind":"Identifier","name":"createOrder","span":{"start":{"line":18,"column":19,"index":366},"end":{"line":18,"column":19,"index":366}}},"params":[{"kind":"ParamSig","name":{"kind":"Identifier","name":"input","span":{"start":{"line":18,"column":25,"index":372},"end":{"line":18,"column":25,"index":372}}},"type":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"userId","span":{"start":{"line":18,"column":35,"index":382},"end":{"line":18,"column":35,"index":382}}},"type":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":18,"column":41,"index":388},"end":{"line":18,"column":41,"index":388}}},"span":{"start":{"line":18,"column":27,"index":374},"end":{"line":18,"column":27,"index":374}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"total","span":{"start":{"line":18,"column":48,"index":395},"end":{"line":18,"column":48,"index":395}}},"type":{"kind":"BasicType","name":"Float","span":{"start":{"line":18,"column":56,"index":403},"end":{"line":18,"column":56,"index":403}}},"span":{"start":{"line":18,"column":27,"index":374},"end":{"line":18,"column":27,"index":374}}}],"span":{"start":{"line":18,"column":27,"index":374},"end":{"line":18,"column":27,"index":374}}},"span":{"start":{"line":18,"column":25,"index":372},"end":{"line":18,"column":25,"index":372}}}],"returnType":{"kind":"GenericType","name":{"kind":"Identifier","name":"Result","span":{"start":{"line":18,"column":66,"index":413},"end":{"line":18,"column":66,"index":413}}},"params":[{"kind":"NamedType","name":{"kind":"Identifier","name":"Order","span":{"start":{"line":18,"column":72,"index":419},"end":{"line":18,"column":72,"index":419}}},"span":{"start":{"line":18,"column":72,"index":419},"end":{"line":18,"column":72,"index":419}}},{"kind":"NamedType","name":{"kind":"Identifier","name":"OrderError","span":{"start":{"line":18,"column":84,"index":431},"end":{"line":18,"column":84,"index":431}}},"span":{"start":{"line":18,"column":84,"index":431},"end":{"line":18,"column":84,"index":431}}}],"span":{"start":{"line":18,"column":66,"index":413},"end":{"line":18,"column":66,"index":413}}},"uses":[{"kind":"Identifier","name":"http","span":{"start":{"line":18,"column":95,"index":442},"end":{"line":18,"column":95,"index":442}}},{"kind":"Identifier","name":"random","span":{"start":{"line":18,"column":104,"index":451},"end":{"line":18,"column":104,"index":451}}}],"body":{"kind":"Block","statements":[{"kind":"LetStmt","id":{"kind":"Identifier","name":"id","span":{"start":{"line":19,"column":10,"index":463},"end":{"line":19,"column":10,"index":463}}},"init":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"random","span":{"start":{"line":19,"column":18,"index":471},"end":{"line":19,"column":18,"index":471}}},"span":{"start":{"line":19,"column":18,"index":471},"end":{"line":19,"column":18,"index":471}}},"property":{"kind":"Identifier","name":"next","span":{"start":{"line":19,"column":23,"index":476},"end":{"line":19,"column":23,"index":476}}},"span":{"start":{"line":19,"column":23,"index":476},"end":{"line":19,"column":23,"index":476}}},"args":[],"span":{"start":{"line":19,"column":25,"index":478},"end":{"line":19,"column":25,"index":478}}},"property":{"kind":"Identifier","name":"toString","span":{"start":{"line":19,"column":34,"index":487},"end":{"line":19,"column":34,"index":487}}},"span":{"start":{"line":19,"column":34,"index":487},"end":{"line":19,"column":34,"index":487}}},"args":[],"span":{"start":{"line":19,"column":36,"index":489},"end":{"line":19,"column":36,"index":489}}},"span":{"start":{"line":19,"column":6,"index":459},"end":{"line":19,"column":6,"index":459}}},{"kind":"ReturnStmt","argument":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"http","span":{"start":{"line":20,"column":14,"index":505},"end":{"line":20,"column":14,"index":505}}},"span":{"start":{"line":20,"column":14,"index":505},"end":{"line":20,"column":14,"index":505}}},"property":{"kind":"Identifier","name":"post","span":{"start":{"line":20,"column":19,"index":510},"end":{"line":20,"column":19,"index":510}}},"span":{"start":{"line":20,"column":19,"index":510},"end":{"line":20,"column":19,"index":510}}},"args":[{"kind":"LiteralExpr","value":{"kind":"String","value":"/orders","span":{"start":{"line":20,"column":29,"index":520},"end":{"line":20,"column":29,"index":520}}},"span":{"start":{"line":20,"column":29,"index":520},"end":{"line":20,"column":29,"index":520}}},{"kind":"ObjectExpr","fields":[{"kind":"ObjectField","key":{"kind":"Identifier","name":"id","span":{"start":{"line":20,"column":35,"index":526},"end":{"line":20,"column":35,"index":526}}},"value":{"kind":"BrandCastExpr","target":{"kind":"Identifier","name":"OrderId","span":{"start":{"line":20,"column":50,"index":541},"end":{"line":20,"column":50,"index":541}}},"value":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"id","span":{"start":{"line":20,"column":54,"index":545},"end":{"line":20,"column":54,"index":545}}},"span":{"start":{"line":20,"column":54,"index":545},"end":{"line":20,"column":54,"index":545}}},"span":{"start":{"line":20,"column":55,"index":546},"end":{"line":20,"column":55,"index":546}}},"span":{"start":{"line":20,"column":31,"index":522},"end":{"line":20,"column":31,"index":522}}},{"kind":"ObjectField","key":{"kind":"Identifier","name":"userId","span":{"start":{"line":20,"column":63,"index":554},"end":{"line":20,"column":63,"index":554}}},"value":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"input","span":{"start":{"line":20,"column":70,"index":561},"end":{"line":20,"column":70,"index":561}}},"span":{"start":{"line":20,"column":70,"index":561},"end":{"line":20,"column":70,"index":561}}},"property":{"kind":"Identifier","name":"userId","span":{"start":{"line":20,"column":77,"index":568},"end":{"line":20,"column":77,"index":568}}},"span":{"start":{"line":20,"column":77,"index":568},"end":{"line":20,"column":77,"index":568}}},"span":{"start":{"line":20,"column":31,"index":522},"end":{"line":20,"column":31,"index":522}}},{"kind":"ObjectField","key":{"kind":"Identifier","name":"total","span":{"start":{"line":20,"column":84,"index":575},"end":{"line":20,"column":84,"index":575}}},"value":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"input","span":{"start":{"line":20,"column":91,"index":582},"end":{"line":20,"column":91,"index":582}}},"span":{"start":{"line":20,"column":91,"index":582},"end":{"line":20,"column":91,"index":582}}},"property":{"kind":"Identifier","name":"total","span":{"start":{"line":20,"column":98,"index":589},"end":{"line":20,"column":98,"index":589}}},"span":{"start":{"line":20,"column":98,"index":589},"end":{"line":20,"column":98,"index":589}}},"span":{"start":{"line":20,"column":31,"index":522},"end":{"line":20,"column":31,"index":522}}}],"span":{"start":{"line":20,"column":31,"index":522},"end":{"line":20,"column":31,"index":522}}}],"span":{"start":{"line":20,"column":100,"index":591},"end":{"line":20,"column":100,"index":591}}},"span":{"start":{"line":20,"column":9,"index":500},"end":{"line":20,"column":9,"index":500}}}],"span":{"start":{"line":18,"column":104,"index":451},"end":{"line":18,"column":104,"index":451}}},"span":{"start":{"line":18,"column":7,"index":354},"end":{"line":18,"column":7,"index":354}}}],"span":{"start":{"line":1,"column":1,"index":0},"end":{"line":22,"column":1,"index":597}}}}
{"source_il":"intent \"Payment service\" tags [\"payments\"]\r\n\r\nuses {\r\n  http: Http { baseUrl: \"https://api.example.com\", timeoutMs: 3000 },\r\n}\r\n\r\ntypes {\r\n  type CardNumber = String brand \"CardNumber\" where matches(\"^\\\\d{16}$\");\r\n  type PaymentId = Uuid;\r\n  type Payment =\r\n    | Card { id: PaymentId, card: CardNumber }\r\n    | Cash { id: PaymentId, amount: Float where _ >= 0 };\r\n  type PaymentError = { code: Int, message: String };\r\n}\r\n\r\neffect processPayment(p: Payment): Result<Bool, PaymentError> uses http {\n  return http.post(\"/payments\", p);\n}\n","transpiled_ts":"export type CardNumber = string & Brand<\"CardNumber\">;\nexport type PaymentId = string;\nexport type Payment =\n  | { type: \"Card\"; id: PaymentId; card: CardNumber }\n  | { type: \"Cash\"; id: PaymentId; amount: number };\nexport interface PaymentError {\n  code: number;\n  message: string;\n}\n\nexport async function processPayment(\n  deps: { http: Http },\n  p: Payment,\n): Promise<Result<boolean, PaymentError>> {\n  return deps.http.post<boolean>(\"/payments\", p);\n}\n","ast":null}
{"source_il":"intent \"User service\" tags [\"api\",\"users\"]\r\n\r\nuses {\r\n  http: Http { baseUrl: \"https://api.example.com\", timeoutMs: 2500 },\r\n  clock: Clock {},\r\n}\r\n\r\ntypes {\r\n  type Email = String brand \"Email\" where matches(\"^[^@]+@[^@]+\\\\.[^@]+$\");\r\n  type UserId = Uuid;\r\n  type User = {\r\n    id: UserId,\r\n    name: String where _.length >= 2,\r\n    email: Email,\r\n    createdAt: DateTime,\r\n  };\r\n  type ApiError = { code: Int, message: String };\r\n}\r\n\r\nfunc toEmail(s: String): Result<Email, String> {\r\n  if matches(\"^[^@]+@[^@]+\\\\.[^@]+$\", s) {\r\n    return Ok(brand<Email>(s));\r\n  } else {\r\n    return Err(\"Invalid email\");\r\n  }\r\n}\r\n\r\neffect createUser(input: { name: String, email: Email }): Result<User, ApiError> uses http, clock {\r\n  return http.post(\"/users\", {\r\n    name: input.name,\r\n    email: input.email,\r\n    createdAt: clock.now(),\r\n  });\r\n}\r\n","transpiled_ts":"export type Email = string & Brand<\"Email\">;\nexport type UserId = string;\nexport interface User {\n  id: UserId;\n  name: string;\n  email: Email;\n  createdAt: Date;\n}\nexport interface ApiError {\n  code: number;\n  message: string;\n}\n\nexport function toEmail(s: string): Result<Email, string> {\n  return /^[^@]+@[^@]+\\.[^@]+$/.test(s)\n    ? { type: \"Ok\", value: s as Email }\n    : { type: \"Err\", error: \"Invalid email\" };\n}\n\nexport async function createUser(\n  deps: { http: Http; clock: Clock },\n  input: { name: string; email: Email },\n): Promise<Result<User, ApiError>> {\n  return deps.http.post<User>(\"/users\", {\n    ...input,\n    createdAt: deps.clock.now(),\n  });\n}\n","ast":{"kind":"Program","intent":{"kind":"IntentSection","description":"User service","tags":["api","users"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},"uses":{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":60},"end":{"line":4,"column":7,"index":60}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":67},"end":{"line":4,"column":14,"index":67}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":103},"end":{"line":4,"column":50,"index":103}}},"timeoutMs":{"kind":"Number","value":2500,"span":{"start":{"line":4,"column":67,"index":120},"end":{"line":4,"column":67,"index":120}}}},"span":{"start":{"line":3,"column":5,"index":50},"end":{"line":3,"column":5,"index":50}}},{"kind":"UseDecl","name":{"kind":"Identifier","name":"clock","span":{"start":{"line":5,"column":8,"index":132},"end":{"line":5,"column":8,"index":132}}},"typeName":{"kind":"Identifier","name":"Clock","span":{"start":{"line":5,"column":16,"index":140},"end":{"line":5,"column":16,"index":140}}},"params":{},"span":{"start":{"line":3,"column":5,"index":50},"end":{"line":3,"column":5,"index":50}}}],"span":{"start":{"line":3,"column":5,"index":50},"end":{"line":3,"column":5,"index":50}}},"types":{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Email","span":{"start":{"line":9,"column":14,"index":172},"end":{"line":9,"column":14,"index":172}}},"expr":{"kind":"BrandType","base":{"kind":"BasicType","name":"String","span":{"start":{"line":9,"column":28,"index":186},"end":{"line":9,"column":28,"index":186}}},"brand":"Email","span":{"start":{"line":9,"column":28,"index":186},"end":{"line":9,"column":28,"index":186}}},"refinement":"matches(\"^[^@]+@[^@]+\\\\.[^@]+$\")","span":{"start":{"line":9,"column":7,"index":165},"end":{"line":9,"column":7,"index":165}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"UserId","span":{"start":{"line":10,"column":15,"index":250},"end":{"line":10,"column":15,"index":250}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":10,"column":21,"index":256},"end":{"line":10,"column":21,"index":256}}},"span":{"start":{"line":10,"column":7,"index":242},"end":{"line":10,"column":7,"index":242}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"User","span":{"start":{"line":11,"column":13,"index":271},"end":{"line":11,"column":13,"index":271}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":12,"column":7,"index":282},"end":{"line":12,"column":7,"index":282}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"UserId","span":{"start":{"line":12,"column":15,"index":290},"end":{"line":12,"column":15,"index":290}}},"span":{"start":{"line":12,"column":15,"index":290},"end":{"line":12,"column":15,"index":290}}},"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"name","span":{"start":{"line":13,"column":9,"index":301},"end":{"line":13,"column":9,"index":301}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":13,"column":23,"index":315},"end":{"line":13,"column":23,"index":315}}},"refinement":"_.length >= 2","span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"email","span":{"start":{"line":14,"column":10,"index":341},"end":{"line":14,"column":10,"index":341}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"Email","span":{"start":{"line":14,"column":17,"index":348},"end":{"line":14,"column":17,"index":348}}},"span":{"start":{"line":14,"column":17,"index":348},"end":{"line":14,"column":17,"index":348}}},"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"createdAt","span":{"start":{"line":15,"column":14,"index":364},"end":{"line":15,"column":14,"index":364}}},"type":{"kind":"BasicType","name":"DateTime","span":{"start":{"line":15,"column":24,"index":374},"end":{"line":15,"column":24,"index":374}}},"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}}],"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},"span":{"start":{"line":11,"column":7,"index":265},"end":{"line":11,"column":7,"index":265}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"ApiError","span":{"start":{"line":17,"column":17,"index":399},"end":{"line":17,"column":17,"index":399}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":17,"column":25,"index":407},"end":{"line":17,"column":25,"index":407}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":17,"column":30,"index":412},"end":{"line":17,"column":30,"index":412}}},"span":{"start":{"line":17,"column":19,"index":401},"end":{"line":17,"column":19,"index":401}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":17,"column":39,"index":421},"end":{"line":17,"column":39,"index":421}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":17,"column":48,"index":430},"end":{"line":17,"column":48,"index":430}}},"span":{"start":{"line":17,"column":19,"index":401},"end":{"line":17,"column":19,"index":401}}}],"span":{"start":{"line":17,"column":19,"index":401},"end":{"line":17,"column":19,"index":401}}},"span":{"start":{"line":17,"column":7,"index":389},"end":{"line":17,"column":7,"index":389}}}],"span":{"start":{"line":8,"column":6,"index":155},"end":{"line":8,"column":6,"index":155}}},"items":[{"kind":"IntentSection","description":"User service","tags":["api","users"],"span":{"start":{"line":1,"column":7,"index":6},"end":{"line":1,"column":7,"index":6}}},{"kind":"UsesSection","entries":[{"kind":"UseDecl","name":{"kind":"Identifier","name":"http","span":{"start":{"line":4,"column":7,"index":60},"end":{"line":4,"column":7,"index":60}}},"typeName":{"kind":"Identifier","name":"Http","span":{"start":{"line":4,"column":14,"index":67},"end":{"line":4,"column":14,"index":67}}},"params":{"baseUrl":{"kind":"String","value":"https://api.example.com","span":{"start":{"line":4,"column":50,"index":103},"end":{"line":4,"column":50,"index":103}}},"timeoutMs":{"kind":"Number","value":2500,"span":{"start":{"line":4,"column":67,"index":120},"end":{"line":4,"column":67,"index":120}}}},"span":{"start":{"line":3,"column":5,"index":50},"end":{"line":3,"column":5,"index":50}}},{"kind":"UseDecl","name":{"kind":"Identifier","name":"clock","span":{"start":{"line":5,"column":8,"index":132},"end":{"line":5,"column":8,"index":132}}},"typeName":{"kind":"Identifier","name":"Clock","span":{"start":{"line":5,"column":16,"index":140},"end":{"line":5,"column":16,"index":140}}},"params":{},"span":{"start":{"line":3,"column":5,"index":50},"end":{"line":3,"column":5,"index":50}}}],"span":{"start":{"line":3,"column":5,"index":50},"end":{"line":3,"column":5,"index":50}}},{"kind":"TypesSection","declarations":[{"kind":"TypeDecl","name":{"kind":"Identifier","name":"Email","span":{"start":{"line":9,"column":14,"index":172},"end":{"line":9,"column":14,"index":172}}},"expr":{"kind":"BrandType","base":{"kind":"BasicType","name":"String","span":{"start":{"line":9,"column":28,"index":186},"end":{"line":9,"column":28,"index":186}}},"brand":"Email","span":{"start":{"line":9,"column":28,"index":186},"end":{"line":9,"column":28,"index":186}}},"refinement":"matches(\"^[^@]+@[^@]+\\\\.[^@]+$\")","span":{"start":{"line":9,"column":7,"index":165},"end":{"line":9,"column":7,"index":165}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"UserId","span":{"start":{"line":10,"column":15,"index":250},"end":{"line":10,"column":15,"index":250}}},"expr":{"kind":"BasicType","name":"Uuid","span":{"start":{"line":10,"column":21,"index":256},"end":{"line":10,"column":21,"index":256}}},"span":{"start":{"line":10,"column":7,"index":242},"end":{"line":10,"column":7,"index":242}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"User","span":{"start":{"line":11,"column":13,"index":271},"end":{"line":11,"column":13,"index":271}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"id","span":{"start":{"line":12,"column":7,"index":282},"end":{"line":12,"column":7,"index":282}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"UserId","span":{"start":{"line":12,"column":15,"index":290},"end":{"line":12,"column":15,"index":290}}},"span":{"start":{"line":12,"column":15,"index":290},"end":{"line":12,"column":15,"index":290}}},"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"name","span":{"start":{"line":13,"column":9,"index":301},"end":{"line":13,"column":9,"index":301}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":13,"column":23,"index":315},"end":{"line":13,"column":23,"index":315}}},"refinement":"_.length >= 2","span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"email","span":{"start":{"line":14,"column":10,"index":341},"end":{"line":14,"column":10,"index":341}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"Email","span":{"start":{"line":14,"column":17,"index":348},"end":{"line":14,"column":17,"index":348}}},"span":{"start":{"line":14,"column":17,"index":348},"end":{"line":14,"column":17,"index":348}}},"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"createdAt","span":{"start":{"line":15,"column":14,"index":364},"end":{"line":15,"column":14,"index":364}}},"type":{"kind":"BasicType","name":"DateTime","span":{"start":{"line":15,"column":24,"index":374},"end":{"line":15,"column":24,"index":374}}},"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}}],"span":{"start":{"line":11,"column":15,"index":273},"end":{"line":11,"column":15,"index":273}}},"span":{"start":{"line":11,"column":7,"index":265},"end":{"line":11,"column":7,"index":265}}},{"kind":"TypeDecl","name":{"kind":"Identifier","name":"ApiError","span":{"start":{"line":17,"column":17,"index":399},"end":{"line":17,"column":17,"index":399}}},"expr":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"code","span":{"start":{"line":17,"column":25,"index":407},"end":{"line":17,"column":25,"index":407}}},"type":{"kind":"BasicType","name":"Int","span":{"start":{"line":17,"column":30,"index":412},"end":{"line":17,"column":30,"index":412}}},"span":{"start":{"line":17,"column":19,"index":401},"end":{"line":17,"column":19,"index":401}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"message","span":{"start":{"line":17,"column":39,"index":421},"end":{"line":17,"column":39,"index":421}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":17,"column":48,"index":430},"end":{"line":17,"column":48,"index":430}}},"span":{"start":{"line":17,"column":19,"index":401},"end":{"line":17,"column":19,"index":401}}}],"span":{"start":{"line":17,"column":19,"index":401},"end":{"line":17,"column":19,"index":401}}},"span":{"start":{"line":17,"column":7,"index":389},"end":{"line":17,"column":7,"index":389}}}],"span":{"start":{"line":8,"column":6,"index":155},"end":{"line":8,"column":6,"index":155}}},{"kind":"FuncDecl","name":{"kind":"Identifier","name":"toEmail","span":{"start":{"line":20,"column":13,"index":451},"end":{"line":20,"column":13,"index":451}}},"params":[{"kind":"ParamSig","name":{"kind":"Identifier","name":"s","span":{"start":{"line":20,"column":15,"index":453},"end":{"line":20,"column":15,"index":453}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":20,"column":23,"index":461},"end":{"line":20,"column":23,"index":461}}},"span":{"start":{"line":20,"column":15,"index":453},"end":{"line":20,"column":15,"index":453}}}],"returnType":{"kind":"GenericType","name":{"kind":"Identifier","name":"Result","span":{"start":{"line":20,"column":32,"index":470},"end":{"line":20,"column":32,"index":470}}},"params":[{"kind":"NamedType","name":{"kind":"Identifier","name":"Email","span":{"start":{"line":20,"column":38,"index":476},"end":{"line":20,"column":38,"index":476}}},"span":{"start":{"line":20,"column":38,"index":476},"end":{"line":20,"column":38,"index":476}}},{"kind":"BasicType","name":"String","span":{"start":{"line":20,"column":46,"index":484},"end":{"line":20,"column":46,"index":484}}}],"span":{"start":{"line":20,"column":32,"index":470},"end":{"line":20,"column":32,"index":470}}},"body":{"kind":"Block","statements":[{"kind":"IfStmt","test":{"kind":"CallExpr","callee":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"matches","span":{"start":{"line":21,"column":13,"index":501},"end":{"line":21,"column":13,"index":501}}},"span":{"start":{"line":21,"column":13,"index":501},"end":{"line":21,"column":13,"index":501}}},"args":[{"kind":"LiteralExpr","value":{"kind":"String","value":"^[^@]+@[^@]+\\.[^@]+$","span":{"start":{"line":21,"column":37,"index":525},"end":{"line":21,"column":37,"index":525}}},"span":{"start":{"line":21,"column":37,"index":525},"end":{"line":21,"column":37,"index":525}}},{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"s","span":{"start":{"line":21,"column":40,"index":528},"end":{"line":21,"column":40,"index":528}}},"span":{"start":{"line":21,"column":40,"index":528},"end":{"line":21,"column":40,"index":528}}}],"span":{"start":{"line":21,"column":42,"index":530},"end":{"line":21,"column":42,"index":530}}},"consequent":{"kind":"Block","statements":[{"kind":"ReturnStmt","argument":{"kind":"ResultOkExpr","value":{"kind":"BrandCastExpr","target":{"kind":"Identifier","name":"Email","span":{"start":{"line":22,"column":26,"index":558},"end":{"line":22,"column":26,"index":558}}},"value":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"s","span":{"start":{"line":22,"column":29,"index":561},"end":{"line":22,"column":29,"index":561}}},"span":{"start":{"line":22,"column":29,"index":561},"end":{"line":22,"column":29,"index":561}}},"span":{"start":{"line":22,"column":30,"index":562},"end":{"line":22,"column":30,"index":562}}},"span":{"start":{"line":22,"column":31,"index":563},"end":{"line":22,"column":31,"index":563}}},"span":{"start":{"line":22,"column":11,"index":543},"end":{"line":22,"column":11,"index":543}}}],"span":{"start":{"line":21,"column":42,"index":530},"end":{"line":21,"column":42,"index":530}}},"alternate":{"kind":"Block","statements":[{"kind":"ReturnStmt","argument":{"kind":"ResultErrExpr","error":{"kind":"LiteralExpr","value":{"kind":"String","value":"Invalid email","span":{"start":{"line":24,"column":31,"index":608},"end":{"line":24,"column":31,"index":608}}},"span":{"start":{"line":24,"column":31,"index":608},"end":{"line":24,"column":31,"index":608}}},"span":{"start":{"line":24,"column":32,"index":609},"end":{"line":24,"column":32,"index":609}}},"span":{"start":{"line":24,"column":11,"index":588},"end":{"line":24,"column":11,"index":588}}}],"span":{"start":{"line":23,"column":10,"index":575},"end":{"line":23,"column":10,"index":575}}},"span":{"start":{"line":21,"column":5,"index":493},"end":{"line":21,"column":5,"index":493}}}],"span":{"start":{"line":20,"column":48,"index":486},"end":{"line":20,"column":48,"index":486}}},"span":{"start":{"line":20,"column":5,"index":443},"end":{"line":20,"column":5,"index":443}}},{"kind":"EffectDecl","name":{"kind":"Identifier","name":"createUser","span":{"start":{"line":28,"column":18,"index":639},"end":{"line":28,"column":18,"index":639}}},"params":[{"kind":"ParamSig","name":{"kind":"Identifier","name":"input","span":{"start":{"line":28,"column":24,"index":645},"end":{"line":28,"column":24,"index":645}}},"type":{"kind":"RecordType","fields":[{"kind":"RecordField","name":{"kind":"Identifier","name":"name","span":{"start":{"line":28,"column":32,"index":653},"end":{"line":28,"column":32,"index":653}}},"type":{"kind":"BasicType","name":"String","span":{"start":{"line":28,"column":40,"index":661},"end":{"line":28,"column":40,"index":661}}},"span":{"start":{"line":28,"column":26,"index":647},"end":{"line":28,"column":26,"index":647}}},{"kind":"RecordField","name":{"kind":"Identifier","name":"email","span":{"start":{"line":28,"column":47,"index":668},"end":{"line":28,"column":47,"index":668}}},"type":{"kind":"NamedType","name":{"kind":"Identifier","name":"Email","span":{"start":{"line":28,"column":55,"index":676},"end":{"line":28,"column":55,"index":676}}},"span":{"start":{"line":28,"column":55,"index":676},"end":{"line":28,"column":55,"index":676}}},"span":{"start":{"line":28,"column":26,"index":647},"end":{"line":28,"column":26,"index":647}}}],"span":{"start":{"line":28,"column":26,"index":647},"end":{"line":28,"column":26,"index":647}}},"span":{"start":{"line":28,"column":24,"index":645},"end":{"line":28,"column":24,"index":645}}}],"returnType":{"kind":"GenericType","name":{"kind":"Identifier","name":"Result","span":{"start":{"line":28,"column":65,"index":686},"end":{"line":28,"column":65,"index":686}}},"params":[{"kind":"NamedType","name":{"kind":"Identifier","name":"User","span":{"start":{"line":28,"column":70,"index":691},"end":{"line":28,"column":70,"index":691}}},"span":{"start":{"line":28,"column":70,"index":691},"end":{"line":28,"column":70,"index":691}}},{"kind":"NamedType","name":{"kind":"Identifier","name":"ApiError","span":{"start":{"line":28,"column":80,"index":701},"end":{"line":28,"column":80,"index":701}}},"span":{"start":{"line":28,"column":80,"index":701},"end":{"line":28,"column":80,"index":701}}}],"span":{"start":{"line":28,"column":65,"index":686},"end":{"line":28,"column":65,"index":686}}},"uses":[{"kind":"Identifier","name":"http","span":{"start":{"line":28,"column":91,"index":712},"end":{"line":28,"column":91,"index":712}}},{"kind":"Identifier","name":"clock","span":{"start":{"line":28,"column":99,"index":720},"end":{"line":28,"column":99,"index":720}}}],"body":{"kind":"Block","statements":[{"kind":"ReturnStmt","argument":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"http","span":{"start":{"line":29,"column":14,"index":736},"end":{"line":29,"column":14,"index":736}}},"span":{"start":{"line":29,"column":14,"index":736},"end":{"line":29,"column":14,"index":736}}},"property":{"kind":"Identifier","name":"post","span":{"start":{"line":29,"column":19,"index":741},"end":{"line":29,"column":19,"index":741}}},"span":{"start":{"line":29,"column":19,"index":741},"end":{"line":29,"column":19,"index":741}}},"args":[{"kind":"LiteralExpr","value":{"kind":"String","value":"/users","span":{"start":{"line":29,"column":28,"index":750},"end":{"line":29,"column":28,"index":750}}},"span":{"start":{"line":29,"column":28,"index":750},"end":{"line":29,"column":28,"index":750}}},{"kind":"ObjectExpr","fields":[{"kind":"ObjectField","key":{"kind":"Identifier","name":"name","span":{"start":{"line":30,"column":9,"index":763},"end":{"line":30,"column":9,"index":763}}},"value":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"input","span":{"start":{"line":30,"column":16,"index":770},"end":{"line":30,"column":16,"index":770}}},"span":{"start":{"line":30,"column":16,"index":770},"end":{"line":30,"column":16,"index":770}}},"property":{"kind":"Identifier","name":"name","span":{"start":{"line":30,"column":21,"index":775},"end":{"line":30,"column":21,"index":775}}},"span":{"start":{"line":30,"column":21,"index":775},"end":{"line":30,"column":21,"index":775}}},"span":{"start":{"line":29,"column":30,"index":752},"end":{"line":29,"column":30,"index":752}}},{"kind":"ObjectField","key":{"kind":"Identifier","name":"email","span":{"start":{"line":31,"column":10,"index":787},"end":{"line":31,"column":10,"index":787}}},"value":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"input","span":{"start":{"line":31,"column":17,"index":794},"end":{"line":31,"column":17,"index":794}}},"span":{"start":{"line":31,"column":17,"index":794},"end":{"line":31,"column":17,"index":794}}},"property":{"kind":"Identifier","name":"email","span":{"start":{"line":31,"column":23,"index":800},"end":{"line":31,"column":23,"index":800}}},"span":{"start":{"line":31,"column":23,"index":800},"end":{"line":31,"column":23,"index":800}}},"span":{"start":{"line":29,"column":30,"index":752},"end":{"line":29,"column":30,"index":752}}},{"kind":"ObjectField","key":{"kind":"Identifier","name":"createdAt","span":{"start":{"line":32,"column":14,"index":816},"end":{"line":32,"column":14,"index":816}}},"value":{"kind":"CallExpr","callee":{"kind":"MemberExpr","object":{"kind":"IdentifierExpr","id":{"kind":"Identifier","name":"clock","span":{"start":{"line":32,"column":21,"index":823},"end":{"line":32,"column":21,"index":823}}},"span":{"start":{"line":32,"column":21,"index":823},"end":{"line":32,"column":21,"index":823}}},"property":{"kind":"Identifier","name":"now","span":{"start":{"line":32,"column":25,"index":827},"end":{"line":32,"column":25,"index":827}}},"span":{"start":{"line":32,"column":25,"index":827},"end":{"line":32,"column":25,"index":827}}},"args":[],"span":{"start":{"line":32,"column":27,"index":829},"end":{"line":32,"column":27,"index":829}}},"span":{"start":{"line":29,"column":30,"index":752},"end":{"line":29,"column":30,"index":752}}}],"span":{"start":{"line":29,"column":30,"index":752},"end":{"line":29,"column":30,"index":752}}}],"span":{"start":{"line":33,"column":5,"index":836},"end":{"line":33,"column":5,"index":836}}},"span":{"start":{"line":29,"column":9,"index":731},"end":{"line":29,"column":9,"index":731}}}],"span":{"start":{"line":28,"column":99,"index":720},"end":{"line":28,"column":99,"index":720}}},"span":{"start":{"line":28,"column":7,"index":628},"end":{"line":28,"column":7,"index":628}}}],"span":{"start":{"line":1,"column":1,"index":0},"end":{"line":35,"column":1,"index":842}}}}
